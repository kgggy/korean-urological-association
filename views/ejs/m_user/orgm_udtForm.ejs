<!--주소api-->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
   window.onload = function () {
      document.getElementById("address_kakao").addEventListener("click", function () {
         new daum.Postcode({
            oncomplete: function (data) {
               // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분입니다.
               // 예제를 참고하여 다양한 활용법을 확인해 보세요.
               document.getElementById("address_kakao").value = data.address; // 주소 넣기
               document.querySelector("input[id=address_detail]").focus(); //상세입력 포커싱
            }
         }).open();
      });
   }
</script>
<style>
   .phone {
      width: 90px;
   }
</style>
<main class="main">
   <!-- Breadcrumb-->
   <ol class="breadcrumb">
      <li class="breadcrumb-item">Home</li>
      <li class="breadcrumb-item">
         <a style="font-weight: bold;">회원관리</a>
      </li>
      <li class="breadcrumb-item active">회원정보</li>
      <!-- Breadcrumb Menu-->
   </ol>

   <div class="container-fluid">
      <div class="animated fadeIn">
         <div class="row">
            <div class="col-lg-6">
               <div class="card">
                  <div class="card-header">
                     <i class="fa fa-align-justify"></i> 회원정보 수정</div>
                  <div class="card-body">
                     <!-- 컨텐츠 -->
                     <form action="" id="userForm" method="" enctype="multipart/form-data">
                        <input type="hidden" name="page" value="<%=page%>">
                        <input type="hidden" name="admin" value="<%=admin%>">
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">회원번호</label>
                           <div class="col-md-9">
                              <input class="form-control" id="uid" type="text" name="uid" value="<%=result.uid%>"
                                 readonly>
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">프로필사진</label>
                           <div class="col-md-9">
                              <% if(userImg != null && userImg != '') {%> <img src="../../../<%= userImg %>" alt="사진"
                                    width="40%" />
                                 <!-- <button id="searchAction" class="btn btn-block btn-outline-danger" type="button"
                                 onclick="javascript:file_del();">삭제</button> -->
                                 <button name="searchAction" class="btn btn-block btn-outline-danger fileDelete"
                                    type="button" data-route="<%=userImg%>" data-img="userImg"
                                    data-inputReset="userImg">삭제</button>
                                 </td>
                                 <% }else{ %>
                                 <input type="file" id="file" name="userImg" />
                                 <% } %>
                                 <input type="hidden" id="userImg" name="userImg" value="<%=userImg%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">회원명</label>
                           <div class="col-md-9">
                              <input class="form-control" id="userName" type="text" name="userName"
                                 value="<%=result.userName%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">휴대번호</label>
                           <div class="col-md-9" style="display: flex;text-align: center;align-items: center;">
                              <input class="form-control phone" id="userPhone1" type="text" name="userPhone1"
                                 value="<%=result.userPhone1%>">&nbsp;&nbsp;-&nbsp;&nbsp;
                              <input class="form-control phone" id="userPhone2" type="text" name="userPhone2"
                                 value="<%=result.userPhone2%>">&nbsp;&nbsp;-&nbsp;&nbsp;
                              <input class="form-control phone" id="userPhone3" type="text" name="userPhone3"
                                 value="<%=result.userPhone3%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">이메일</label>
                           <div class="col-md-9">
                              <input class="form-control" id="userEmail" type="text" name="userEmail" value="<%=result.userEmail%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">팩스번호</label>
                           <div class="col-md-9">
                              <input class="form-control" id="userFax" type="text" name="userFax" value="<%=result.userFax%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">병원명</label>
                           <div class="col-md-9">
                              <input class="form-control" id="hosName" type="text" name="hosName"
                                 value="<%=result.hosName%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">우편번호</label>
                           <div class="col-md-9">
                              <input class="form-control" id="hosPost" type="text" name="hosPost"
                                 value="<%=result.hosPost%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">병원주소</label>
                           <div class="col-md-9">
                              <input class="form-control" type="text" id="address_kakao" name="userAdres" value="<%=result.userAdres1%> <%=result.userAdres2%> <%=result.userAdres3%>" />
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">상세주소</label>
                           <div class="col-md-9">
                              <input class="form-control" type="text" id="address_detail" name="userAdres4" value="<%=result.userAdres4%>"
                                 placeholder="상세주소를 입력해주세요" />
                           </div>
                        </div>
                        
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">병원번호</label>
                           <div class="col-md-9" style="display: flex;text-align: center;align-items: center;">
                              <input class="form-control phone" id="hosPhone1" type="text" name="hosPhone1"
                                 value="<%=result.hosPhone1%>">&nbsp;&nbsp;-&nbsp;&nbsp;
                              <input class="form-control phone" id="hosPhone2" type="text" name="hosPhone2"
                                 value="<%=result.hosPhone2%>">&nbsp;&nbsp;-&nbsp;&nbsp;
                              <input class="form-control phone" id="hosPhone3" type="text" name="hosPhone3"
                                 value="<%=result.hosPhone3%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">홈페이지</label>
                           <div class="col-md-9">
                              <input class="form-control" id="userUrl" type="text" name="userUrl" value="<%=result.userUrl%>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">형태</label>
                           <div class="col-md-9">
                              <select class="dropdown" name="userType">
                                 <% for(i = 0; i < userType.length; i++) { %>
                                 <option <%if(userType[i].userType=='형태'){%> value="" <%}else{%> value="<%= userType[i].userType %>" <%}%> <%if(userType[i].userType==result.userType){%> selected="selected" <%}%>><%= userType[i].userType %></option>
                                 <% } %>
                              </select>
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">역할</label>
                           <div class="col-md-9">
                              <select class="dropdown" name="userPosition">
                                 <% for(i = 0; i < userPosition.length; i++) { %>
                                 <option <%if(userPosition[i].userPosition=='전체'){%> value="" <%}else{%> value="<%= userPosition[i].userPosition %>" <%}%> <%if(userPosition[i].userPosition==result.userPosition){%> selected="selected" <%}%>><%= userPosition[i].userPosition %></option>
                                 <% } %>
                              </select>
                           </div>
                        </div>
                        <!-- <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">푸쉬알림</label>
                           <div class="col-md-9">
                              <select class="dropdown" name="pushYn">
                                 <option value="0" <%if(result.pushYn=="0"){%> selected="selected" <%}%>>동의</option>
                                 <option value="1" <%if(result.pushYn=="1"){%> selected="selected" <%}%>>비동의</option>
                             </select>
                           </div>
                        </div>  -->
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">병원세부설명</label>
                           <div class="col-md-9">
                              <input class="form-control" id="hosDetail" type="text" name="hosDetail"
                                 value="<%= result.hosDetail %>">
                           </div>
                        </div>
                        <div class="form-group row">
                           <label class="col-md-2 col-form-label" for="text-input">병원사진</label>
                           <div class="col-md-9">
                              <% if(result.fileRoute != null) { %>
                              <% for(var i = 0; i <  result.fileRoute.length; i++) {%>
                                 <img src="../../../<%= result.fileRoute[i] %>" alt="사진"
                                        style="padding:0 50px 8px 0 !important; width:40%; vertical-align: top !important;" />
                                        <button name="fileDelete" class="btn btn-block btn-outline-danger fileDelete"
                                        type="button" data-route="<%= result.fileRoute[i] %>" data-img="file"
                                        data-inputReset="file">삭제</button>
                                 <% } %>
                              <% if( result.fileRoute.length < 6) { %>
                                 <% for(var i = 0; i < 6- result.fileRoute.length; i++) {%>
                                 <br><br><input type="file" id="file" name="file" /><br><br>
                                 <% } %>
                                 <% } %>
                              <% }else{ %>
                                 <div style="display: flex; flex-direction: column; gap: 25px;">
                                    <input type="file" id="file" name="file">
                                    <input type="file" id="file" name="file" />
                                    <input type="file" id="file" name="file" />
                                    <input type="file" id="file" name="file" />
                                    <input type="file" id="file" name="file" />
                                    <input type="file" id="file" name="file" />
                                 </div>
                              <% } %>
                           </div>
                        </div>
                     </form>
                     <!--option 버튼  -->
                     <div class="option_button">
                        <div>
                           <button class="btn btn-block btn-outline-success" type="button" id="update_btn"
                              onclick="userUpdate()">수정</button>
                        </div>
                        <div>
                           <button class="btn btn-block btn-outline-danger" type="button"
                              onclick="location.href='/admin/m_user/selectOne?uid=<%=result.uid%>&page=<%=page%>&admin=<%=admin%>'">
                              취소</button>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</main>

<script type="text/javascript">
   $(document).ready(function () {
      //확장자 체크
      $("input:file[name='file']").change(function () {
         var str = $(this).val();
         var fileName = str.split('\\').pop().toLowerCase();
         // alert(fileName);
         checkFileName(fileName);
      });
   });
   //확장자 체크
   function checkFileName(str) {
      var ext = str.split('.').pop().toLowerCase();
      // alert(ext);
      if ($.inArray(ext, ['jpg', 'png', 'jpeg', 'gif']) == -1) {
         alert(ext + '파일은 업로드 하실 수 없습니다.');
         $("input:file[name='file']").val("");
      }
   }
   //수정
   function userUpdate() {
      var userName = $("#userName").val();

      if (userName == '') {
         alert("회원명을 입력해주세요.");
         $("#userName").focus();
         return false;
      }

      if (confirm("수정하시겠습니까?")) {
         $("#userForm").attr("action", "userUpdate");
         $("#userForm").attr("method", "post");
         $("#userForm").submit();
         alert("수정이 완료되었습니다.");
      }
   }

   //첨부파일 삭제
   // function file_del() {
   //    if (confirm("실제 파일이 삭제됩니다 \n정말 삭제하시겠습니까?")) {
   //       $("#userForm").attr("action", "imgDelete");
   //       $("#userForm").attr("method", "get");
   //       $("#userForm").submit();
   //    }
   // }

   $('button[name="fileDelete"]').on('click', function (e) {
      parent = this.parentNode;
      // parent.innerHTML = "";
      console.log(parent)
     this.parentNode.remove();
      // this.setAttribute('disabled', 'true');
      // // console.log(parent.innerHTML)
      // const input = document.createElement('input');
      // parent.append(input);
      // input.setAttribute('type', 'hidden');
      // input.setAttribute('name', 'deleteFileRoute');
      // input.value = this.dataset['route'];
      // const inputReset = document.createElement('input');
      // const resetName = this.dataset['inputreset']
      // inputReset.setAttribute('type', 'file');
      // inputReset.setAttribute('id', 'file');
      // inputReset.setAttribute('name', resetName);
      // // inputReset.className += 'certiImg'
      // parent.append(inputReset);
   })
</script>